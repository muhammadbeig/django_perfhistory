<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Historical Performance - {{ type }}s</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    
    <!-- Le styles -->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">

    
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->


    <script type="text/javascript">
       var x='{{ an_attrib}}';
   </script>
   <script src="//code.jquery.com/jquery-1.10.1.min.js" type="text/javascript"></script>
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

   <script type="text/javascript">
    // $('.collapse').collapse()
</script>

<div class="page-header">
    <h1>Historical Performance <small>{{ type }}s </small></h1>
</div>

</head>

<body>


    <form class="form-inline" action="/perfhistory/projects" method="post">
        {% csrf_token %}
        {% load css_filter %}

        {% for field in form %}
        


        {{ field|addcss:"form-control" }}
        
        
        {% endfor %}

        <input type="submit" class="btn btn-primary" value="Create {{ type }}">
    </form>



<!--     <div>
        <div class="panel panel-primary">
            
            <div class="panel-heading">{{ type }} List</div>
            <div class="panel-body">
                <p>Given below is a list of projects results for which exist in the repository</p>

            </div>


            <!-- Table -->
      <!--       <table class="table table-striped table-bordered">
                <th align="center">{{ type }} Id</th>
                <th align="center">{{ type }} Name</th>
                <th align="center">{{ type }} Description</th>
                <th align="center">Created</th>
                <th align="center">Last modified</th>

                {% for obj in object_list %}

                <tr >

                    {% load tz %}

                    <td align="center"> <a href="project/{{ obj.id }}" > {{ obj.id }}</a> </td>

                    <td align="center"> {{ obj.name}} </a> </td>

                    <td align="center">{{ obj.description }} </td>
                    <td align="center">{{ obj.created |date:"Y/m/d h:m:s TZ" }} </td>
                    <td align="center">{{ obj.last_modified |localtime}} </td>

                </tr>

                {% endfor %}


            </table>
        </div>
    </div>
</div> -->



<script>
function createTable(pid, object_list){
     
    mytable = $('<table></table>').attr({ id: "tagTable_"+pid,class: ["table", "table-striped", "table-bordered"].join(' ') });
    
    // var rows = 2;//new Number($("#rowcount").val());
    // var cols = 2;//new Number($("#columncount").val());
    var tr = [];
    if (object_list.length > 0)
    {
        // console.log('object_list'+object_list);
        // console.log('zero-th object'+object_list[0]["tag_name"]);
        
        $('<th></th>').text("Name").attr({ align: "center"}).appendTo(mytable);
        $('<th></th>').text("Description").attr({ align: "center"}).appendTo(mytable);    
        for (var i=0; i<object_list.length; i++)
        {
            var row = $('<tr></tr>').appendTo(mytable);
            $('<td></td>').text(object_list[i]["tag_name"]).attr({ align: "center"}).appendTo(row); 
            $('<td></td>').text(object_list[i]["tag_description"]).attr({ align: "center"}).appendTo(row); 
        }

        console.log("TTTTT:"+mytable.html());
        $('#collapse_'+pid).children('.panel-body').children('#tableplaceholder').append(mytable);  

    }  
  
}
</script>




<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
    <script type="text/javascript">
        $(function()
        {
            $('.collapsed').on('click', function(event) 
            {
                var pid=event.currentTarget.dataset.pid;
                console.log(pid);
                var jqxhr = $.get( "/perfhistory/project/"+pid+"/getTags",function(f) 
                {
                  console.log('dats', f );
                  createTable(pid, f);

                })
                .done(function(d) {
                    console.log( d );
                })
                .fail(function(e) {
                    console.log( "error",e );
                })
                .always(function() {
                    console.log( "finished" );
                });

            // Perform other work here ...

            // Set another completion function for the request above
            jqxhr.always(function() {
              console.log( "second finished" );
            });

            });

            
                
        });


      $(document).ready(function() 
      {
            
        $('[id^=tagform_]').submit(function(e,data)
        {
            var projectid=e.currentTarget.dataset.projectId;
            // console.log('add tag button', e.currentTarget.dataset.projectId);
            console.log(e);
            console.log(data);
            e.preventDefault();
            create_tag(projectid);
        });

    });

    function create_tag(projectid)
    {
        var jqxhr = $.post( "/perfhistory/project/"+projectid+"/createTag", function() 
            {
                console.log("Success" );
            })
            .done(function() 
            {
                
                console.log("second success" );
             })
             .fail(function() 
             {
               console.log("Error" );
             })
            .always(function() 
            {
                console.log("Finished" );
            });
    }
            


    </script>

    <ul class="list-group">
        {% for obj in object_list %}


        <li class="list-group-item"> 

          <div class="panel panel-default">

            <div class="panel-heading" role="tab" id="heading_{{ obj.id }}">

              <h4 class="panel-title">

                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse_{{ obj.id }}" aria-expanded="false" aria-controls="collapse_{{ obj.id }}" data-pid="{{ obj.id}}">
                  <small>{{ obj.id}}. </small> {{ obj.name}} <small>{{ obj.description}}</small>
              </a>
          </h4>
      </div>






      <div id="collapse_{{ obj.id }}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading_{{ obj.id }}">
          <div class="panel-body">
            <ul><b>Name:</b> <a href="project/{{ obj.id }}" > {{ obj.name }} </a> </ul>
            <ul><b>Description:</b> {{ obj.description }} </ul>
            <ul><b>Created:</b> {{ obj.created }} </ul>
            <ul><b>Last Modified:</b> {{ obj.last_modified }} </ul>

            <div id="tableplaceholder"></div>

             <script type="text/javascript">
        //             // form_count = $("[name=extra_field_count");
        //     // get extra form count so we know what index to use for the next item.
        //     $("#add-another").click(function() 
        //     {
        //         element = $('<input type="text"/>');
        //         element.attr('name', 'extra_field_' + form_count);
        //         $("#forms_{{ obj.id }}").append(element);
        //         console.log("objId: {{ obj.id }}")
        //         // build element and append it to our forms container

        //         form_count ++;
        //         $("[name=extra_field_count]").val(form_count);
        //         // increment form count so our view knows to populate 
        //         // that many fields for validation
        //     })

         </script>

        <div id="tag_form">
        <form id="tagform_{{ obj.id }}" data-project-id="{{ obj.id }}" class="form-inline" method="post" action="/perfhistory/project/{{ obj.id }}/createTag">
            <div >
                   {% csrf_token %}
                    {% load css_filter %}

                    {% for field in tagForm %}
                    


                    {{ field|addcss:"form-control" }}
                    
                    
                    {% endfor %}
                <!-- {{ tagForm.as_p }} -->
            <input type="submit" id="AddTagButton" class="btn btn-default" />
            </div>
            <!-- <button id="add-another" class="btn btn-default">add another</button> -->
            
        </form>
        </div>


    </div>
</div>
</div>
</li>

{% endfor %}





<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" type="text/javascript"></script>





</body>
</html>